---
layout: post
title: C语言中的指针
categories: [C]
description: C语言中的指针
keywords: C, 指针
---

## 变量与地址

指针就是存储变量地址的变量。看下面的代码：
```
int i;
int *p;

i = 1;
p = &i;
printf("i=%d\n", i);
printf("%p\n", &i);
printf("%p\n", p);
printf("*p=%d\n", *p);
```
输出结果：
```
i=1
&i=0x7fffaadb8d6c
p=0x7fffaadb8d6c
*p=1
```
指针变量p的值就是变量i的地址，指针p指向地址存储的值即i变量的值。

## 指针与指针变量

指针变量即存储指针地址的变量。看如下代码：
```
int i = 1;
int *p;
int **q;

i = 1;
p = &i;
q = &p;
printf("i=%d\n", i);
printf("&i=%p\n",&i);
printf("p=%p\n", p);
printf("&p=%p\n", &p);
printf("*p=%d\n", *p);
printf("q=%p\n", q);
printf("*q=%p\n", *q);
printf("**q=%d\n", **q);
```
输出结果：
```
i=1
&i=0x7ffc9ab866f4
p=0x7ffc9ab866f4
&p=0x7ffc9ab866f8
*p=1
q=0x7ffc9ab866f8
*q=0x7ffc9ab866f4
**q=1
```
根据以上结果可以推导出：
```
q=&p
*q=*(&p)=p=&i
**q=*(*q)=*p=i
```

不管是何种类型的指针，指针在一个平台所占的大小是固定的，比如：在32位的操作系统中指针占4个字节，在64位的操作系统占8字节。看如下例子：
```
int *p;
int **q;
float *f;
double *d;
char *c;

printf("%d\n", sizeof(p));
printf("%d\n", sizeof(q));
printf("%d\n", sizeof(f));
printf("%d\n", sizeof(d));
printf("%d\n", sizeof(c));
```
输出结果：
```
8
8
8
8
8
```
各个类型的指针大小均为8个字节大小。另外需要注意，指针与所指向的变量类型必须相同，因为指针会找对应类型大小存储空间来读取变量的值，例如：如果指针的类型是char，那么这个指针会读取指针指向地址一个字节大小的值，如果这个指针的变量是int，那么这个指针会读取指向地址4个字节大小的值。当然这里说指向char类型指针的类型是char，指向int类型指针的类型是int，这种说法是不准确的，指向char类型指针的变量类型应该是char*，指向int类型指针的变量类型应该是int*。


## 空指针与野指针
```
int *p=NULL;
```
NULL即为空指针。NULL是值为0的宏，表示指向起始地址为0的地址空间。如果操作指向NULL的指针，会得到一个段错误的提示。在指针定义出来，并不清楚指针将如何适用的时候，将指针指向空指针。

野指针是指向不确认的指针。使用空指针初始化指针，就是为了避免野指针，从而避免未知的错误。

指针一旦定义出来就应该有一个确定的指向，如果没有就应该指向NULL。

## 空类型

空类型指针即void*类型的指针。空类型的指针可以赋给任何类型的指针，任何类型的指针也可以赋给空类型指针。

void*类型指针除了与函数指针相互赋值是未定义行为，其他任何类型的指针都可以相互赋值。

### 指针与数组

数组名其实就是数组的起始地址。看如下代码：
```
int a[] = {1,2,3};
int i;
int *p = a;
for(i = 0;i<sizeof(a)/sizeof(a[0]);i++){
    printf("%p = %d\n", &a[i], a[i]);
    printf("%p = %d\n", p+i, *(p+i));
}
```
输出结果：
```
0x7ffebe72e69c = 1
0x7ffebe72e69c = 1
0x7ffebe72e6a0 = 2
0x7ffebe72e6a0 = 2
0x7ffebe72e6a4 = 3
0x7ffebe72e6a4 = 3
```
推导出:
```
a[i]=*(a+i)=*(p+i)=p[i]
```
数组变量a和指针变量p的区别在于，数组变量a是常量，无法改变a的值，但是指针p可以，执行`a++`会报错，执行`p++`不会。

### 指针与二维数组

### 指针与字符数组

## const与指针

## 指针数组和数组指针

## 多级指针

