---
layout: post
title: C语言中的构造类型
categories: [C]
description: C语言中的构造类型
keywords: C, 结构体, 共用体
---

## 结构体

### 结构体的定义：
```
struct 结构体名
{
    数据类型 成员1;
    数据类型 成员2;
    ......
};
```
结构体本身不占用内容，占用内容的是结构体的变量。结构体还可以嵌套定义：
```
struct birthday_st{
    int year;
    int month;
    int day;
};

struct student_st{
    int id;
    char name[1024];
    int math;
    int chinese;
    struct birthday_st birth;
};
```
或者：
```
struct student_st{
    int id;
    char name[1024];
    int math;
    int chinese;
    struct birthday_st{
        int year;
        int month;
        int day;
    } birth;
};
```
需要注意的是，结构体需要先定义后使用。结构体的变量只是表示的结构体的起始位置。

### 结构体变量的初始化及成员引用

成员引用：

- 变量名.成员名
- 指针->成员名
- (*指针).成员名

看下面例子：
```
struct simple_st{
    int i;
    float f;
    char ch;
};

struct simple_st a = {123,456.789,'a'};
//只初始出化部分成员
struct simple_st b = {.f=6.66,.ch='b'};
a.i = 112233;
```

结构体数组的声明和初始化：
```
struct student_st arr[2]={{10011,"Alan",{2011,11,11},98,97},{10012,"John",{2012,12,2},90.80}};
```

### 结构体占用的空间
看下面的例子：
```
struct simple_st{
    int i;
    float f;
    char ch;
};


int main(){
    struct simple_st a;
    struct simple_st *p=&a;
    
    printf("sizeof(point) = %d\n", sizeof(p));
    printf("sizeof(struct) = %d\n", sizeof(a));
    exit(0);
}
```
输出结果：
```
sizeof(point) = 8
sizeof(struct) = 12
```
根据结果，结构体指针大小是固定的，64位操作系统是8字节，32位的是4字节。但是结构体的大小却不是结构体成员占用空间大小之后，simple_st结构体成员占用空间应该是4+4+1=9，而实际的输出占用空间为12。占用空间为12是因为地址对齐，存储数据的时候会以int的大小对齐。

另外，因为不同机器上面地址对齐的方式不一样，在网络上传输的数据应该避免地址对齐，可以通过定义宏的方式告诉编译器不对齐：
```
struct simple_st{
    int i;
    float f;
    char ch;
}__attribute__((packed));
``` 
另外，由于结构体传参时候是采用值传递的方式，这样会比较浪费内存，所以作为参数的时候一般都是采用指针传递。